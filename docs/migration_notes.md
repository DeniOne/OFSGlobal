# Памятка по миграции на Staff и Division

## Глобальная цель
Полное удаление моделей Staff и Division, переход на Staff и Division

## Текущие проблемы
- Конфликты в ORM из-за двух моделей, ссылающихся на одни таблицы
- Ошибки при инициализации маппера: `employee_locations failed to locate a name`
- API должностей возвращает 500 Internal Server Error
- Страница должностей показывает ошибку "Failed to fetch"

## Факты о проекте
- Фронтенд уже использует термины "staff" и "divisions"
- URL в браузере остаются `/staff` и возможно `/divisions`
- В CRUD есть алиасы: `staff = staff` и `division = division`
- Таблица организации называется "organization" (в единственном числе)
- В модели `Staff` ссылка ForeignKey должна быть на "organization.id", а не "organizations.id"

## Важные места в коде
- `backend/app/crud/__init__.py` - содержит алиасы для обратной совместимости
- `backend/app/models/organization.py` - содержит отношения к staff и staff
- `backend/app/models/staff.py` - старая модель, содержит проблемные отношения
- `backend/app/models/staff.py` - новая модель, нужно убедиться, что она содержит все нужные поля
- `backend/app/api/api_v1/endpoints/positions.py` - содержит API для должностей

## Технические заметки
- API нужно проверить на использование асинхронных функций (async/await)
- Не забыть обновить вызов `get_multi` в API должностей после всех изменений
- Проверить связи в модели `FunctionalRelation`, она может использовать Staff вместо Staff
- Проблема с `employee_locations` указывает на то, что эта таблица не определена, но используется

## Проверочный список после изменений
- [ ] Backend запускается без ошибок
- [ ] API должностей возвращает 200 OK
- [ ] Страница должностей загружает данные
- [ ] Страница сотрудников работает
- [ ] Страница отделов работает
- [ ] Функциональные связи работают

## Что делать при возникновении ошибок
1. Проверить логи сервера
2. Проверить наличие всех необходимых таблиц в БД
3. Проверить соответствие имен таблиц в моделях и внешних ключах
4. Проверить наличие циклических зависимостей между моделями 